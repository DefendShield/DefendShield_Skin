Write-Host "Starting Windows Pentest Environment Setup..." -ForegroundColor Cyan

# Function to check and install a package
function Install-Package {
    param (
        [string]$Id,
        [string]$Name
    )
    Write-Host "Checking for $Name..." -NoNewline
    $list = winget list --id $Id
    if ($list -like "*$Id*") {
        Write-Host " [Installed]" -ForegroundColor Green
    } else {
        Write-Host " [Missing]" -ForegroundColor Yellow
        Write-Host "Installing $Name ($Id)..." -ForegroundColor Cyan
        winget install --id $Id -e --accept-source winget --accept-package-agreements
    }
}

# 1. Network Analysis
Install-Package "WiresharkFoundation.Wireshark" "Wireshark"

# 2. Web Analysis
Install-Package "PortSwigger.BurpSuiteCommunity" "Burp Suite Community"
Install-Package "OWASP.ZAP" "OWASP ZAP"

# 3. Scanning
Install-Package "Insecure.Nmap" "Nmap"

# 4. Reverse Engineering
Install-Package "NSA.Ghidra" "Ghidra"
Install-Package "x64dbg.x64dbg" "x64dbg"

# 5. Utilities & Dev
Install-Package "Python.Python.3.11" "Python 3.11"
Install-Package "Microsoft.VisualStudioCode" "VS Code"
Install-Package "Hashcat.Hashcat" "Hashcat"
Install-Package "OpenJS.NodeJS" "Node.js"

# 6. Nerd Fonts for Terminal Customization (CaskaydiaCove is popular)
Install-Package "JanDeDobbeleer.OhMyPosh" "Oh My Posh"
Write-Host "Note: For fonts, you may need to manually install a Nerd Font if you want icons in your terminal." -ForegroundColor Yellow

# 7. Hardware Access (WSL USB Support)
Install-Package "dorssel.usbipd-win" "USBIPD-WIN"
Write-Host "Note: USBIPD is essential for using WiFi adapters or USB gadgets inside Kali WSL." -ForegroundColor Yellow

Write-Host "`nSetup of Native Tools Complete!" -ForegroundColor Green
Write-Host "Next Steps:"
Write-Host "1. Restart your terminal to ensure PATH updates take effect."
Write-Host "2. Run 'wsl' and update your Kali instance."
